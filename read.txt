You are performing the most comprehensive, strictest possible audit of the LoveIQ marketing website codebase. This is a Next.js 16 App Router static marketing site with API routes for waitlist signup and contact form 
  submission. It is deployed on Vercel. There is NO user authentication — this is a pre-launch marketing site collecting waitlist emails.

  Read EVERY file I reference below. For each audit area, provide:
  1. A severity rating: CRITICAL / HIGH / MEDIUM / LOW / INFO
  2. The exact file and line number
  3. What the issue is
  4. How it can be exploited or what risk it poses
  5. The specific fix (with code if applicable)

  At the end, provide a summary scorecard rating each category 1-10 and an overall security posture grade (A-F).

  ---

  ## PART 1: SECURITY AUDIT (Highest Priority)

  ### 1.1 Middleware / Security Headers — Read: `proxy.ts`

  CRITICAL CHECK: The file is named `proxy.ts` and exports `export function proxy()` — NOT `export function middleware()` and NOT in `middleware.ts`. Verify whether Next.js 16 actually executes this middleware. If the  
  function must be named `middleware` or the file must be `middleware.ts`, then ALL security headers (CSP, HSTS, X-Frame-Options, CSRF cookies) are NOT being applied. This would be the single most critical vulnerability
   in the entire codebase.

  Audit each security header for correctness:
  - Content-Security-Policy: Check every directive. Is `'unsafe-inline'` in script-src acceptable? Is the nonce actually being used for all inline scripts? The nonce is generated but passed via `x-nonce` header — verify
   all `<Script>` tags in `app/layout.tsx` actually consume it. Check if any scripts load WITHOUT the nonce.
  - The CookieYes script at `layout.tsx:131-134` does NOT have a `nonce={nonce}` attribute — does this violate CSP?
  - Are all third-party domains listed in CSP actually needed? Could any be removed?
  - Is `frame-ancestors 'none'` redundant with `X-Frame-Options: DENY`?
  - HSTS: Is `max-age=63072000` (2 years) appropriate? Should `preload` be declared if they haven't submitted to the HSTS preload list?
  - Is `Cross-Origin-Opener-Policy: same-origin-allow-popups` the right policy? Should it be `same-origin` for stricter isolation?
  - Missing: `Cross-Origin-Resource-Policy`, `Cross-Origin-Embedder-Policy` — are these needed?
  - CSRF cookie: `httpOnly: false` (intentionally readable by JS), `secure: production only`, `sameSite: strict`, `maxAge: 24h`. Is this cookie configuration secure? Is 24h too long?
  - The matcher at line 93-103 skips `_next/static`, `_next/image`, `favicon.ico`, `images/` AND requests with `next-router-prefetch` or `purpose: prefetch` headers. Can an attacker add these headers to bypass security 
  headers?
  - API route logging (line 76-88): IP is extracted from `x-real-ip` or `x-forwarded-for` — on Vercel this is fine, but is there a risk of spoofing in other environments?

  ### 1.2 CSRF Protection — Read: `lib/csrf.ts`

  - The double-submit cookie pattern is implemented. Verify the constant-time comparison at lines 34-43 is actually constant-time (the early return at line 34 for length mismatch leaks length information).
  - The cookie name `__csrf` — should it have the `__Host-` prefix for stronger cookie scoping?
  - The CSRF token is 32 bytes (64 hex chars) — is this sufficient entropy?
  - Both forms read the CSRF cookie via `document.cookie.split("; ").find(row => row.startsWith("__csrf="))?.split("=")[1]` — is this parsing robust? What if the cookie value contains `=`?

  ### 1.3 Rate Limiting — Read: `lib/ratelimit.ts`

  CRITICAL: Lines 44-49 and 186-188 — when Supabase is not configured, rate limiting is COMPLETELY DISABLED with just a warning log. In production, if the Supabase connection fails, ALL rate limits are bypassed. Same at
   lines 79-80 and 89-93 (fail-open on errors). This is a design choice but should be documented as a risk.
  - The `checkRateLimitSimple` fallback (line 100-175) — the GET/POST to Supabase REST API is NOT atomic. There's a TOCTOU race condition between reading hits and upserting new hits. An attacker could send many
  concurrent requests that all read the same hit count before any upsert completes.
  - `getClientIp` (line 248-266) trusts `x-real-ip` and `x-forwarded-for` headers. On Vercel this is fine, but in other deployments these headers can be spoofed.
  - The IPv6 regex at line 281 (`/^([0-9a-fA-F]{0,4}:){2,7}[0-9a-fA-F]{0,4}$/`) — does it correctly validate all IPv6 formats including compressed (`::1`), mapped (`::ffff:192.168.1.1`)?
  - Rate limit config: 5 requests per minute for both waitlist and contact. Is this sufficient? Too lenient?
  - Email cooldown: 1 minute per email on waitlist. Could an attacker still send 5 signups per minute with different emails?

  ### 1.4 API Route: Waitlist — Read: `app/api/waitlist/route.ts`

  - Honeypot field `website` (line 14, 32): `z.string().max(0)` validation at schema level, but also checked AFTER parsing at line 116-118. The second check is redundant if Zod catches it — but does Zod `.max(0)` reject
   strings with length > 0 or empty strings?
  - Email normalization: `trim().toLowerCase()` at line 113. Is this sufficient? Should it handle unicode normalization, plus-addressing stripping, or dot-normalization for Gmail?
  - Resend lazy initialization (lines 20-26): The `_resend` variable is module-scoped. In serverless environments (Vercel), is this safe? Could it hold a stale instance across invocations?
  - The existingRes check (line 146-165): Returns `{ success: true, already: true }` for duplicate emails. Does the `already: true` field leak information that the email exists in the database? This could enable email  
  enumeration.
  - Slack notification (line 62): The masking `email.replace(/^(.).+(@.+)$/, "$1***$2")` — is this sufficient PII protection? What if the email is 2 characters before @?
  - Line 201: Slack notification is `await`ed but not error-handled at this level — if Slack fails, the response has already succeeded but we've awaited unnecessarily.
  - The full `email` is sent to Slack via `<mailto:${email}|${maskedEmail}>` (line 62) — the actual full email is in the mailto link despite masking the display text. This defeats the purpose of PII masking.

  ### 1.5 API Route: Contact — Read: `app/api/contact/route.ts`

  - reCAPTCHA verification (lines 38-69): The `verifyCaptcha` function passes the IP to Google's API. Is this a privacy concern?
  - Header injection prevention (lines 163-171): Checks for `\r\n\0` in email, but the email is already validated by Zod `z.string().email()` — would Zod's email validation already reject emails with these characters?  
  - Contact email subject (line 181): `New contact request from ${firstName} ${lastName}` — the first/last name is used directly in the email subject. Could this enable email header injection via the Resend API? Are    
  Resend emails safe from subject injection?
  - The email body (lines 182-188) uses user input (`firstName`, `lastName`, `email`, `phone`, `message`) directly as plaintext — this is safe for plaintext emails but verify Resend doesn't interpret any markup.        
  - Slack notification (lines 84-88): Phone masking `phone.slice(0, 3) + "***" + phone.slice(-2)` — for short phone numbers this could reveal the whole number.
  - The `escapeSlack` function (line 95) escapes `&<>*_~\`` — is this comprehensive for Slack markdown? What about `|`, `[]`, `()`?

  ### 1.6 API Route: Health — Read: `app/api/health/route.ts`

  - This endpoint has NO CSRF protection, NO rate limiting. Can it be used for:
    - Server status probing?
    - DDoS amplification?
    - Is this acceptable for a health check?

  ### 1.7 Email Template — Read: `lib/emails/waitlist.ts`

  - `escapeHtml` function (lines 76-83): Uses `replaceAll` for `& < > " '`. Is this complete? Missing: backtick, forward slash?
  - The HTML template uses inline styles (safe) and the escaped name is only used in the greeting. Verify no other user input is injected into HTML.
  - Is there a risk of CSS injection via the email template?

  ### 1.8 Fetch Wrapper — Read: `lib/fetch-with-timeout.ts`

  - Default timeout is 5000ms. Is this appropriate for all use cases?
  - The error message at line 35 includes the full URL — could this leak internal service URLs in error messages returned to clients?

  ### 1.9 Logger — Read: `lib/logger.ts`

  - PII redaction (lines 5-8): Redacts `email`, `*.email`, `ip`, `*.ip`, `phone`, `*.phone`. Are there other PII fields that should be redacted (e.g., `firstName`, `lastName`, `name`, `*.name`)?
  - `LOG_LEVEL` is configurable via env var — could an attacker who gains access to env vars enable debug logging to see redacted fields? (No, redaction happens regardless of level — just verify.)

  ### 1.10 Environment Variable Handling — Read: `.env.example`, `next.config.js`

  - `NEXT_PUBLIC_SITE_URL` defaults to `http://localhost:3000` in `.env.example` — if deployed without setting this, would it cause any security issues?
  - `next.config.js` removes console.log in production — does this affect error logging via pino?
  - `remotePatterns` allows `images.unsplash.com` and `www.figma.com` — are both actually used? Could they be vectors for SSRF via Next.js image optimization?

  ---

  ## PART 2: CLIENT-SIDE SECURITY

  ### 2.1 Root Layout — Read: `app/layout.tsx`

  - Google Analytics ID `G-QTYY69L46N` is hardcoded (lines 138, 145). Should this be an env var?
  - CookieYes script (line 132-133): The script src `https://cdn-cookieyes.com/client_data/761bc9303937f7b41b200de8ed556d45/script.js` — the ID is hardcoded. Could this be replaced with a malicious script if the        
  CookieYes account is compromised?
  - CookieYes script loads WITHOUT nonce (line 130-134). How does this work with CSP `script-src`? The CSP includes `https://cdn-cookieyes.com` as an allowed source, so it works via domain allowlisting — but does       
  CookieYes inject additional inline scripts that would be blocked?
  - Schema.org data (lines 25-87): Contains business info like email `hello@loveiq.org`, address "Berlin, DE". Verify this is intentional and not leaking internal info.
  - `maximumScale: 5` in viewport — good, not restricting zoom (accessibility compliance).

  ### 2.2 Waitlist Form — Read: `app/waitlist/page.tsx`

  - CSRF token reading (line 93-96): Cookie parsing splits on `"; "` then `"="`. If the cookie value contains `=`, it takes only the part before the first `=` — this would corrupt the token. Use
  `substring(cookie.indexOf('=') + 1)` instead.
  - The honeypot field (lines 150-158): `className="hidden"` — should this use `aria-hidden` and absolute positioning off-screen instead? Some bots detect `display:none` or `hidden` classes.
  - Error message display (line 114): `err instanceof Error ? err.message : "Unable to join waitlist."` — the raw server error message is displayed to the user. If the API returns a detailed error, this could disclose  
  internal information. However, the API returns generic messages, so this is probably fine — verify all error paths.
  - The `Image` components (lines 201-210) load avatars from `images.unsplash.com` — these are external. Is there a privacy concern with loading third-party images? (Referrer headers, tracking pixels)
  - No client-side rate limiting or debouncing on the submit button — users can spam the button rapidly.

  ### 2.3 Contact Form — Read: `components/about/ContactSection.tsx`

  - reCAPTCHA integration (lines 42-87): `window.grecaptcha` is typed with `Function` (line 44, 47) — this is unsafe. Should be properly typed.
  - The reCAPTCHA site key is accessed via `process.env.NEXT_PUBLIC_RECAPTCHA_SITE_KEY` (line 41) — this is correct for a client component.
  - Polling interval for reCAPTCHA readiness (lines 95-99): 600ms intervals with 8s timeout. If the script never loads, the error message appears but the user can still submit (no guard against submission without       
  captcha — actually there IS at line 126-129). Verify this is airtight.
  - CSRF token reading (line 136-139): Same cookie parsing issue as waitlist form.
  - Form reset on success (line 158) — does this reset also clear any state that could be replayed?

  ### 2.4 Analytics — Read: `lib/analytics.ts`

  - `window.gtag?.()` is safely guarded with optional chaining.
  - No PII is sent in analytics events — verify `source` and `location` params don't contain user data.

  ### 2.5 Smooth Scroll — Read: `components/SmoothScroll.tsx`

  - User-agent sniffing (lines 6-9): `navigator.userAgent` for Gecko/Firefox detection. Is this used for any security-relevant purpose? (No, just UX — fine.)
  - Lenis library version `^1.3.17` — check for known vulnerabilities.

  ### 2.6 Search for XSS Vectors

  Search every .tsx file for:
  - `dangerouslySetInnerHTML` (should be zero — I found zero)
  - Direct DOM manipulation via `document.innerHTML`
  - User input rendered without escaping
  - URL construction from user input (potential open redirect)
  - `window.location` manipulation
  - `eval()`, `Function()`, `setTimeout(string)`, `setInterval(string)`
  - Any use of `href` or `src` with dynamic user-controlled values

  ---

  ## PART 3: INFRASTRUCTURE & CI/CD

  ### 3.1 GitHub Actions — Read: `.github/workflows/security.yml`, `.github/workflows/ci.yml`

  - TruffleHog installation (security.yml line 32): Downloads and executes a script from `raw.githubusercontent.com/trufflesecurity/trufflehog` — this is a supply chain risk. The script could be compromised. Should pin 
  to a specific commit hash.
  - Semgrep runs in the `semgrep/semgrep` container — is this image version-pinned? (No — uses latest tag implicitly.)
  - `continue-on-error: true` on CodeQL analysis (line 103) — this means CodeQL failures won't break the build. Is this acceptable?
  - Custom security rules (lines 239-317): The grep-based checks for API route patterns are fragile. A route in a nested directory (e.g., `app/api/foo/bar/route.ts`) would not be caught by `app/api/*/route.ts` glob.    
  - Environment variable check (lines 282-290): The grep for `process.env` in client components — this has false positives and isn't reliable.
  - Build step uses `NEXT_PUBLIC_RECAPTCHA_SITE_KEY: dummy` — is there a risk that the `dummy` value ends up in the production build?
  - All GitHub Actions use pinned commit hashes (e.g., `actions/checkout@34e1148...`) — this is excellent for supply chain security. Verify the hashes are correct for the stated versions.
  - Permissions are properly scoped (`contents: read`, `security-events: write`, `pull-requests: write`).

  ### 3.2 Dependabot — Read: `.github/dependabot.yml`

  - Patches production dependencies but only groups minor+patch dev dependencies. Is this the right strategy?
  - Reviewers are hardcoded GitHub usernames — verify these are actual team members.

  ### 3.3 Package Dependencies — Read: `package.json`

  Audit each dependency for:
  - Known vulnerabilities (run `npm audit`)
  - Necessity (is each package actually used?)
  - Version ranges (are `^` ranges appropriate for security-sensitive packages?)

  Specific checks:
  - `next: ^16.1.6` — latest security patches?
  - `react: ^18.2.0` — Next.js 16 may need React 19. Is this compatibility issue a concern?
  - `zod: ^4.3.4` — Zod 4 is very new. Are there known issues?
  - `resend: ^6.6.0` — check for known vulnerabilities
  - `pino: ^10.3.1` — check for known vulnerabilities
  - `lenis: ^1.3.17` — check for known vulnerabilities
  - Dev dependencies: `csv-parse` is listed — is it actually used? Unnecessary dependencies increase attack surface.

  ### 3.4 TypeScript Configuration — Read: `tsconfig.json`

  - `strict: true` — good
  - `target: "es5"` — this is very old. Modern browsers all support ES2020+. Does this affect any security-related polyfills?
  - No path aliases configured (no `@/` prefix) — the codebase uses relative imports like `../../../lib/csrf`. This is a style choice but makes refactoring harder.

  ---

  ## PART 4: DATA PRIVACY & GDPR

  ### 4.1 Data Collection

  The site collects:
  - Email addresses (waitlist)
  - First name (waitlist, optional)
  - Full contact info (contact form: first name, last name, phone, email, message)
  - IP addresses (rate limiting, stored in Supabase `rate_limits` table)
  - Analytics data (Google Analytics)
  - Cookie consent (CookieYes)

  Audit for GDPR compliance:
  - Is there a mechanism to delete user data (right to be forgotten)?
  - Is there a data retention policy for rate limit records in Supabase?
  - Are the privacy policy pages actually linked and accessible from all forms?
  - Is the CookieYes consent banner properly blocking GA and other tracking before consent?
  - The waitlist form doesn't ask for explicit consent — is the privacy policy link sufficient?
  - IP addresses stored in `rate_limits` table — how long are they retained? Is there automatic cleanup?
  - The contact form sends user data to Slack — is Slack covered in the privacy policy as a data processor?
  - Unsplash images loaded on the waitlist page — does this send user IP/referrer to Unsplash?

  ### 4.2 Cookie Audit

  List every cookie set by the application:
  - `__csrf` — set by middleware, `sameSite: strict`, `secure: production`, `httpOnly: false`, 24h expiry
  - Google Analytics cookies (`_ga`, `_ga_*`, etc.)
  - CookieYes consent cookies
  - Are all cookies properly documented in the cookies page?
  - Is cookie consent obtained before setting the CSRF cookie? (CSRF cookies are typically exempt from consent requirements as "strictly necessary")

  ---

  ## PART 5: SEO & METADATA AUDIT

  ### 5.1 Read: `app/robots.ts`, `app/sitemap.ts`, `app/layout.tsx`

  - `robots.ts`: Allows all crawlers on `/` — no disallow rules. Should `/api/` be disallowed?
  - `sitemap.ts`: Generates entries for all static routes and glossary terms. Are dates using `new Date()` (current time) appropriate or should they use actual modification times?
  - Meta descriptions: Are they within Google's recommended length (150-160 chars)?
  - Open Graph: Missing `og:image` — this means social media shares won't have a preview image.
  - Twitter card: `summary_large_image` is set but no image is provided — this will fall back to no image.
  - Canonical URL uses `NEXT_PUBLIC_SITE_URL` fallback to `https://www.loveiq.org` — is the canonical correct?
  - Schema.org structured data: Organization, Website, and FAQ schemas are included. Verify they follow Google's structured data guidelines.

  ---

  ## PART 6: ACCESSIBILITY AUDIT

  ### 6.1 Check all interactive elements:

  - Navigation (`components/landing/NavSection.tsx`):
    - Mobile menu button has `aria-label="Toggle menu"` and `aria-expanded` — good
    - Escape key closes menu — good
    - But is focus trapped within the open mobile menu?
    - Color contrast of `text-white/80` on dark background — does this meet WCAG AA?
  - Forms: All inputs have `required`, proper `type` attributes
    - Waitlist form: Is there a visible label for the email input? (Only a placeholder `name@email.com` — this is NOT sufficient for accessibility)
    - Contact form: Labels are present — good
  - Status messages: `aria-live="polite"` and `role="status"` on waitlist form — good
  - Error messages: `role="alert"` on contact form errors — good
  - Skip navigation link: Is there one? (Doesn't appear to be)
  - Heading hierarchy: Check all pages for proper h1 > h2 > h3 nesting
  - Images: All decorative images use `aria-hidden` — verify no informational images are missing alt text

  ---

  ## PART 7: PERFORMANCE & RELIABILITY

  ### 7.1 Error Handling

  - What happens if Supabase is completely down? (Rate limiting fails open, waitlist insert fails with 500)
  - What happens if Resend API is down? (Waitlist returns 500 even though the signup was saved)
  - What happens if reCAPTCHA API is down? (Contact form fails)
  - Is there any retry logic for transient failures? (No — should there be?)
  - Are all `fetch()` calls using `fetchWithTimeout`? Verify no bare `fetch()` calls exist in API routes.

  ### 7.2 Video Loading

  - `S01Hero.tsx`: Two video sources — mobile (UHD 4K) and desktop (UHD 4K). Are UHD videos appropriate for a web page? What are the file sizes?
  - `preload="none"` is set — good for performance
  - Video loads after 300ms delay — why not on scroll intersection?

  ---

  ## PART 8: CODE QUALITY

  ### 8.1 Potential Issues

  - `proxy.ts` generates a CSP nonce but it's set as a request header `x-nonce` — verify this header is NOT leaked to the client response
  - `tsconfig.json` targets ES5 but modern APIs like `crypto.getRandomValues()`, `AbortController`, `URLSearchParams` are used — does this cause issues?
  - The `eslint.config.mjs` has a rule to prevent `fetch()` with single argument but API routes use `fetchWithTimeout()` which wraps fetch — does the lint rule still catch raw fetch usage?
  - Relative imports are deeply nested (e.g., `../../../lib/csrf`) — fragile but functional

  ---

  ## PART 9: SPECIFIC VULNERABILITY CHECKS

  Run these specific checks across all source files (NOT node_modules):

  1. **Open Redirect**: Search for any `redirect()` or `window.location =` with user-controlled input
  2. **SSRF**: Check if any API route fetches URLs based on user input
  3. **Path Traversal**: Check for file system operations with user input
  4. **Prototype Pollution**: Check for object spread with unvalidated input
  5. **ReDoS**: Check all regex patterns for catastrophic backtracking potential
  6. **Information Disclosure**: Check all error responses for stack traces or internal details
  7. **Timing Attacks**: Beyond the CSRF comparison, are there other comparison operations that should be constant-time?
  8. **Supply Chain**: Check if all `<Script src="...">` URLs are from legitimate domains

  ---

  ## OUTPUT FORMAT

  For each finding, use this format:

  ### [SEVERITY] Finding Title
  - **File:** `path/to/file.ts:LINE`
  - **Category:** (Security / Privacy / Accessibility / Performance / Code Quality)
  - **Description:** What the issue is
  - **Risk:** How it could be exploited or what impact it has
  - **Fix:** Specific remediation with code example
  - **Status:** (Confirmed / Needs Verification / Potential False Positive)

  At the end, provide:

  ### Summary Scorecard
  | Category | Score (1-10) | Key Issues |
  |----------|-------------|------------|
  | Security Headers & CSP | | |
  | CSRF Protection | | |
  | Rate Limiting | | |
  | Input Validation | | |
  | API Security | | |
  | Client-Side Security | | |
  | CI/CD Security | | |
  | Dependency Security | | |
  | Data Privacy / GDPR | | |
  | Accessibility | | |
  | SEO | | |
  | Error Handling | | |
  | Code Quality | | |
  | **Overall Grade** | **X/10** | **Letter Grade: X** |

  ### Top 5 Most Critical Fixes (Prioritized)
  1. ...
  2. ...
  3. ...
  4. ...
  5. ...